DROP TABLE IF EXISTS #PAT_LIST

CREATE TABLE #PAT_LIST (PATIENTID INT,NPI_NUMBER INT,P_DATE DATE)

INSERT INTO #PAT_LIST VALUES (1,101,'2016-07-01'),(1,101,'2017-01-01'),(1,102,'2018-02-01'),
							 (2,104,'2016-08-01'),(2,103,'2017-10-01'),(2,103,'2018-12-01')

SELECT * FROM (
				SELECT PATIENTID,NPI_NUMBER,'NPI'+CONVERT(VARCHAR,DENSE_RANK() OVER (PARTITION BY PATIENTID ORDER BY PROCEDURE_DATE)) AS NPI FROM 
				( 
				 SELECT PATIENTID,NPI_NUMBER,MIN(P_DATE) AS PROCEDURE_DATE FROM #PAT_LIST
				 GROUP BY PATIENTID,NPI_NUMBER
				) T1 
              ) T2 
PIVOT ( MAX(NPI_NUMBER) FOR NPI IN ([NPI1],[NPI2])) PVT
